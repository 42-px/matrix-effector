import e,{EventType as t,encodeUnpaddedBase64 as n,decodeRecoveryKey as r,deriveKey as o,encodeBase64 as a,Direction as i,MatrixEvent as s,SearchOrderBy as c,EventStatus as u,VerificationRequestEvent as d}from"matrix-js-sdk";export{MatrixEvent,Room,RoomMember}from"matrix-js-sdk";import{throttle as f}from"patronum/throttle";import{createDomain as l,combine as m,forward as p,attach as v,sample as g,guard as w}from"effector";import y from"@babel/runtime/helpers/toConsumableArray";import h from"@babel/runtime/helpers/slicedToArray";import{batchEvents as b}from"@42px/effector-extra";import x from"@babel/runtime/helpers/defineProperty";import k from"@babel/runtime/helpers/asyncToGenerator";import R from"@babel/runtime/regenerator";import{createCustomError as I}from"@42px/custom-errors";import{debounce as D}from"patronum/debounce";import{throttle as S,debounce as C}from"patronum";var F,j,P,U,E=l("root",{name:"root",sid:"-580awt"}),A=E.domain("app",{name:"appDomain",sid:"-quj5h"}),O=A.event({name:"onInitialSync",sid:"-wcesey"}),q=A.event({name:"onCachedState",sid:"ufjkqd"}),M=A.event({name:"onSync",sid:"-ddpo6n"}),B=function(e){return f({source:M,timeout:e})},K=A.effect({name:"loginByPasswordFx",sid:"wlxj4s"}),T=A.effect({name:"loginByTokenFx",sid:"-34brxd"}),_=A.effect({name:"initStoreFx",sid:"-wrkp4g"}),L=A.effect({name:"startClientFx",sid:"-qp9kqf"}),N=A.effect({name:"getLoggedUserFx",sid:"-5bx6oq"}),V=A.effect({name:"stopClientFx",sid:"-rqtsmy"}),z=A.effect({name:"logoutFx",sid:"-t7dvwa"}),$=A.effect({name:"createClientFx",sid:"y0cxc7"}),W=A.effect({name:"destroyClientFx",sid:"-8ki9qr"}),G=A.effect({name:"getProfileInfoFx",sid:"-o4hp22"}),H=E.domain("notification",{name:"notificationDomain",sid:"-u4fkly"}),J=H.effect({name:"getNotificationRulesFx",sid:"-tijmwo"}),Y=H.effect({name:"setNotificationRuleActionFx",sid:"-btv56l"}),Q=H.effect({name:"setNotificationRuleEnabledFx",sid:"yk2cpz"}),X=H.effect({name:"deleteNotificationRuleFx",sid:"gxx6vj"});!function(e){e.Audio="m.audio",e.BadEncrypted="m.bad.encrypted",e.Emote="m.emote",e.File="m.file",e.Image="m.image",e.Notice="m.notice",e.Text="m.text",e.Video="m.video",e.Location="m.location"}(F||(F={})),function(e){e.online="online",e.offline="offline",e.unavailable="unavailable"}(j||(j={})),function(e){e.leave="leave",e.invite="invite",e.ban="ban",e.join="join",e.knock="knock"}(P||(P={})),function(e){e.admin="Admin",e.moderator="Moderator"}(U||(U={}));var Z,ee,te=E.domain("room",{name:"roomDomain",sid:"8pn4fw"}),ne=50,re=50,oe=50,ae=0,ie=50,se=50,ce=te.store(null,{name:"$isLive",sid:"biq7gq"}),ue=te.store(!1,{name:"$loadRoomFxPending",sid:"havabn"}),de=te.store(null,{name:"$currentRoomMembers",sid:"7gwkns"}),fe=te.store(null,{name:"$currentRoomId",sid:"ywkcd5"}),le=te.store(null,{name:"$currentRoom",sid:"-1jeu1j"}),me=te.event({name:"clearCurrentRoomState",sid:"j4tp00"}),pe=te.store(null,{name:"$timelineWindow",sid:"qndo3u"}),ve=te.store(0,{name:"$myPowerLevel",sid:"8dq6jq"}),ge=te.store({},{name:"$typingMembers",sid:"-me86d1"}),we=te.store(50,{name:"$requiredPowerLevelForKick",sid:"-p7q3wn"}),ye=te.store(50,{name:"$requiredPowerLevelForInvite",sid:"-rmtuy6"}),he=te.store(50,{name:"$requiredPowerLevelForBan",sid:"lw3bvf"}),be=te.store(0,{name:"$requiredPowerLevelForDefaultEvents",sid:"nch0en"}),xe=te.store(50,{name:"$requiredPowerLevelForRedact",sid:"-dvsk1t"}),ke=te.store(50,{name:"$requiredPowerLevelForDefaultState",sid:"vctwz7"}),Re=de.map((function(e){var t;return null!==(t=null==e?void 0:e.filter((function(e){return e.membership===P.join})))&&void 0!==t?t:[]})),Ie=de.map((function(e){var t;return null!==(t=null==e?void 0:e.filter((function(e){return e.membership===P.invite})))&&void 0!==t?t:[]})),De=m({and:[ve,we,function(e,t){return e>=t}],or:{name:"$canKick",sid:"-uw4gut"}}),Se=m({and:[ve,ye,function(e,t){return e>=t}],or:{name:"$canInvite",sid:"1isnfp"}}),Ce=m({and:[ve,he,function(e,t){return e>=t}],or:{name:"$canBan",sid:"oqsvd0"}}),Fe=m({and:[ve,be,function(e,t){return e>=t}],or:{name:"$canSendDefaultEvent",sid:"to9s1j"}}),je=m({and:[ve,xe,function(e,t){return e>=t}],or:{name:"$canRedact",sid:"dup35h"}}),Pe=m({and:[ve,ke,function(e,t){return e>=t}],or:{name:"$canSetDefaultState",sid:"wqvmm5"}}),Ue=m({and:[fe,pe,function(e,t){return Boolean(e)&&Boolean(t)}],or:{name:"$loadFilter",sid:"oiizp9"}}),Ee=te.event({name:"clearTypingMember",sid:"usek85"}),Ae=te.event({name:"toggleTypingUser",sid:"-ipcphv"}),Oe=te.event({name:"onRoomUserUpdate",sid:"-skym4s"}),qe=te.event({name:"onRoomMemberUpdate",sid:"qki6jm"}),Me=te.event({name:"getRoomMembers",sid:"mtv6hm"}),Be=te.event({name:"initRoom",sid:"yaaicc"}),Ke=te.event({name:"liveTimelineLoaded",sid:"-or6o3v"}),Te=te.event({name:"onRoomInitialized",sid:"cblv2l"}),_e=te.event({name:"loadRoomMessageDone",sid:"9vjem4"}),Le=te.event({name:"onRoomLoaded",sid:"ocjheo"}),Ne=te.event({name:"loadRoom",sid:"bt2qg1"}),Ve=te.event({name:"toLiveTimeline",sid:"-gl9mn6"}),ze=te.event({name:"loadRoomMessage",sid:"-iwytb6"}),$e=te.event({name:"directRoomCreated",sid:"-zbt8hv"}),We=te.event({name:"roomCreated",sid:"-lgbuuq"}),Ge=te.effect({name:"findDirectRoomByUserIdFx",sid:"-2waeny"}),He=te.effect({name:"searchRoomMessagesFx",sid:"-d5go0s"}),Je=te.effect({name:"getRoomsWithActivitiesFx",sid:"jppqdf"}),Ye=te.effect({name:"getRoomInfoFx",sid:"xm6ing"}),Qe=te.effect({name:"getAllUsersFx",sid:"-qxdxsk"}),Xe=te.effect({name:"createRoomFx",sid:"vqvy0s"}),Ze=te.effect({name:"createDirectRoomFx",sid:"kckfrq"}),et=te.effect({name:"inviteUserFx",sid:"-l5vb8l"}),tt=te.effect({name:"inviteUsersFx",sid:"sg5hv2"}),nt=te.effect({name:"kickUserRoomFx",sid:"-lr0eu"}),rt=te.effect({name:"renameRoomFx",sid:"-bgt8od"}),ot=te.effect({name:"joinRoomFx",sid:"-d80qig"}),at=te.effect({name:"leaveRoomFx",sid:"r6rdkz"}),it=te.effect({name:"loadRoomFx",sid:"s3uakz"}),st=te.effect({name:"getRoomByIdFx",sid:"-tu48z8"}),ct=te.effect({name:"sendTypingFx",sid:"-calb1t"}),ut=te.effect({name:"getMembersByRoomIdFx",sid:"-8qd4w1"}),dt=te.effect({name:"getRoomMemberFx",sid:"-q1nofi"}),ft=te.effect({name:"getPermissionsByRoomIdFx",sid:"xszjk2"}),lt=te.effect({name:"getUserDevicesFx",sid:"7mi70c"});!function(e){e.public="public",e.private="private"}(Z||(Z={})),function(e){e.trustedPrivateChat="trusted_private_chat",e.privateChat="private_chat",e.publicChat="public_chat"}(ee||(ee={}));var mt,pt,vt=E.domain("messages",{name:"messagesDomain",sid:"-n5xw59"}),gt=vt.store([],{name:"$messages",sid:"-4n59uw"}),wt=vt.store(null,{name:"$currentRoomUnreadMessageCount",sid:"-rmmbkv"}),yt=vt.event({name:"updateMessages",sid:"ioi3w6"}),ht=vt.event({name:"roomMessage",sid:"hxi5sm"}),bt=vt.event({name:"newMessagesLoaded",sid:"-i370kr"}),xt=vt.event({name:"onUploadProgress",sid:"-6dpitj"}),kt=vt.event({name:"onPaginateBackwardDone",sid:"cdc004"}),Rt=vt.event({name:"onPaginateForwardDone",sid:"90dr37"}),It=vt.event({name:"paginateForward",sid:"dn14jp"}),Dt=vt.event({name:"paginateBackward",sid:"-pdbfm9"}),St=vt.store(!1,{name:"$paginateForwardPending",sid:"h6qc1m"}),Ct=vt.store(!1,{name:"$paginateBackwardPending",sid:"-vpw0c1"}),Ft=vt.store(!0,{name:"$canPaginateBackward",sid:"-2bc5kc"}),jt=vt.store(!0,{name:"$canPaginateForward",sid:"eew5jk"}),Pt=vt.effect({name:"sendMessageFx",sid:"-kj76br"}),Ut=vt.effect({name:"editMessageFx",sid:"-krzw3v"}),Et=vt.effect({name:"deleteMessageFx",sid:"-zg0rui"}),At=vt.effect({name:"readAllMessagesFx",sid:"-l9cm2r"}),Ot=vt.effect({name:"checkEventPermissionsFx",sid:"-yfsmo"}),qt=vt.effect({name:"uploadContentFx",sid:"-vaykf8"}),Mt=vt.effect({name:"getUrlPreviewFx",sid:"tmsrjl"}),Bt=E.domain("profile",{name:"d",sid:"-otmju7"}),Kt=Bt.effect({name:"updateDisplayNameFx",sid:"bxxcda"}),Tt=Bt.effect({name:"updateAvatarUrlFx",sid:"-z1g9je"}),_t=500,Lt=[],Nt=function(){mt&&(mt.removeAllListeners(),mt=null)},Vt=function(t){var n=t.options,r=t.messageBatchInterval;Nt(),void 0!==r&&(_t=r),mt=e.createClient(n),Lt.forEach((function(e){var t=h(e,2),n=t[0],r=t[1];mt.on(n,r)}))},zt=function(){return mt},$t=function(e){Lt.push.apply(Lt,y(e))},Wt=function(){return b(ht,_t)};!function(e){e[e.Unsent=1]="Unsent",e[e.Requested=2]="Requested",e[e.Ready=3]="Ready",e[e.Started=4]="Started",e[e.Cancelled=5]="Cancelled",e[e.Done=6]="Done"}(pt||(pt={}));var Gt=l("verificationDomain",{name:"verificationDomain",sid:"-o0z075"}),Ht=Gt.store([],{name:"$currentVerificationEvent",sid:"-i5yph3"}),Jt=Gt.event({name:"setCurrentVerificationEvent",sid:"castib"}),Yt=Gt.effect({name:"cancelVerificationEventFx",sid:"-vymeoe"}),Qt=Gt.store([],{name:"$verificationEvents",sid:"1emr0s"}),Xt=Gt.event({name:"onVerificationRequest",sid:"rxlaek"}),Zt=Gt.event({name:"startSASVerification",sid:"-g09tpa"}),en=Gt.event({name:"confirmSASVerification",sid:"-1404as"}),tn=Gt.store(null,{name:"$deviceIsVerified",sid:"-5k8b9p"}),nn=Gt.event({name:"onUpdateDeviceList",sid:"-3ttikg"}),rn=Gt.effect({name:"checkThisDeviceVerificationFx",sid:"-hbp4dg"}),on=Gt.event({name:"startVerificationDevice",sid:"-rd5utx"}),an=Gt.effect({name:"startThisDeviceVerificationFx",sid:"-uekf7m"}),sn=Gt.event({name:"startVerificationUser",sid:"-z505nw"}),cn=Gt.event({name:"onRequestAccept",sid:"-r2vtvc"}),un=Gt.event({name:"onRequestCancel",sid:"dfel27"}),dn=Gt.event({name:"cancelAllRequests",sid:"8a0ue2"}),fn=Gt.effect({name:"checkCanVerifyFx",sid:"-7evwpb"}),ln=Gt.event({name:"onUsersProfileUpdate",sid:"-upohjf"}),mn=I("EventNotFound"),pn=I("RoomNotFound"),vn=I("ClientNotInitialized"),gn=I("TimelineWindowUndefined"),wn=I("UserNotFound"),yn=I("UserNotLoggedIn"),hn=I("CantInviteUsers"),bn=I("NotEnoughPermissions"),xn="m.room.message",kn="m.room.redaction";function Rn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function In(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rn(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Dn=function(e,t,n){return e.seen=n.getJoinedMembers().some((function(r){return r.userId!==t&&n.hasUserReadEvent(r.userId,e.originalEventId)})),e},Sn=function(e){return e.getContent()};function Cn(e,t){var n=e.getRelation();return{originalEventId:void 0!==t?t:e.getId(),content:Sn(e),sender:e.sender,originServerTs:e.getDate(),edited:"m.replace"===(null==n?void 0:n.rel_type),redacted:e.isRedacted()||e.isRedaction()}}function Fn(e){return{roomId:e.roomId,name:e.name,summary:e.summary,myMembership:e.getMyMembership()}}function jn(e,t){return t.isRelation("m.replace")||t.isRedaction()||e.push(Cn(t)),e}var Pn=function(e){var t=zt();return{avatarUrl:e.avatarUrl,userId:e.userId,currentlyActive:e.currentlyActive,displayName:e.displayName,lastActiveAgo:e.lastActiveAgo,lastPresenceTs:e.lastPresenceTs,presence:e.presence,isVerified:t.checkUserTrust(e.userId).isCrossSigningVerified()}};function Un(e){var n,r,o,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:99,s=zt(),c=s.getRoom(e.roomId);if(!c)throw new pn;for(var u=c.getLiveTimeline().getEvents(),d=c.currentState.getStateEvents(t.RoomPowerLevels,"").getContent(),f=Boolean(null===(n=c.currentState.getStateEvents(t.RoomCreate,""))||void 0===n||null===(r=n.getContent())||void 0===r?void 0:r.isDirect),l=0,m=u.length-1;m>=0&&m!==u.length-i;m--){var p=u[m],v=c.hasUserReadEvent(s.getUserId(),p.getId());if(v)break;l+=1}var g=u.filter((function(e){return[xn,kn].includes(e.getType())})),w=g[g.length-1],y=w?Cn(w):void 0,h=s.getUserId();y&&(y.sender.userId!==h?y.seen=c.hasUserReadEvent(h,y.originalEventId):y=Dn(y,h,c));var b=f?c.getMember(c.guessDMUserId()):null,x=null!==(o=d.users[h])&&void 0!==o?o:0;return In(In({},e),{},{unreadCount:l,lastMessage:y,isDirect:f,directUserId:null==b?void 0:b.userId,isOnline:b?Boolean(null===(a=b.user)||void 0===a?void 0:a.currentlyActive):void 0,lastActivityTS:c.getLastActiveTimestamp(),powerlevels:d,myPowerLevel:x,canBan:x>=d.ban,canKick:x>=d.kick,canInvite:x>=d.invite,canRedact:x>=d.redact,canSendEvents:{canChangeHistoryVisivility:x>=d.events[t.RoomHistoryVisibility],canChangeRoomAvatar:x>=d.events[t.RoomAvatar],canChangeRoomName:x>=d.events[t.RoomName],canChangeRoomPowerLevels:x>=d.events[t.RoomPowerLevels],canChangeCanonicalAlias:x>=d.events[t.RoomCanonicalAlias],canChangeRoomEncryption:x>=d.events[t.RoomEncryption],canChangeRoomServerAcl:x>=d.events[t.RoomServerAcl],canChangeRoomTobstone:x>=d.events[t.RoomTombstone]}})}function En(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function An(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?En(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):En(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function On(e){var t=e.getEvents().filter((function(e){return[xn,kn].includes(e.getType())})).reduce(jn,[]),n=zt(),r=e.getEvents()[0].getRoomId(),o=n.getRoom(r);if(!o)throw new pn;for(var a=[],i=[],s=n.getUserId(),c=!1,u=!1,d=t.length-1;d>=0;d--)t[d].sender.userId===s?a.push(t[d]):i.push(t[d]);return a.forEach((function(e){u?e.seen=!0:(e=Dn(e,s,o),u=Boolean(e.seen))})),i.forEach((function(e){c?e.seen=!0:(e.seen=o.hasUserReadEvent(s,e.originalEventId),c=e.seen)})),t}var qn,Mn=function(e){var t=e.sender,n=e.width,r=e.height,o=e.resizeMethod,a=e.allowDefault,i=void 0===a||a,s=e.allowDirectLinks,c=void 0!==s&&s;return t&&t.getAvatarUrl?t.getAvatarUrl(zt().getHomeserverUrl(),n,r,o,i,c):null},Bn=function(e){var t=e.roomId,n=e.userId,r=e.width,o=e.height,a=e.resizeMethod,i=e.allowDefault,s=void 0===i||i,c=zt().getRoom(t);if(!c)return null;var u=c.getMember(n);return u?u.getAvatarUrl(zt().getHomeserverUrl(),r,o,a,s,!0):null},Kn=function(e){var t=e.mxcUrl,n=e.width,r=e.height,o=e.resizeMethod,a=e.allowDirectLinks;return zt().mxcUrlToHttp(t,n,r,void 0!==o?o:"scale",a)},Tn=function(){return{endpointUrl:"".concat(zt().getHomeserverUrl(),"/_matrix/media/r0/upload"),headers:{Authorization:"Bearer ".concat(zt().getAccessToken())}}},_n=function(){var e=k(R.mark((function e(n,r){var o,a,i,s,c,u,d;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=zt(),i=zt().getRoom(n)){e.next=4;break}throw new pn("Room ".concat(n," not found"));case 4:if(s=i.currentState.getStateEvents(t.RoomCreate,"").getContent(),c=s.creator,u=a.getAccountData("m.direct").getContent(),d=null!==(o=u[c])&&void 0!==o?o:[],!r){e.next=11;break}return e.next=10,a.setAccountData("m.direct",An(An({},u),{},x({},r,[n])));case 10:case 13:return e.abrupt("return",e.sent);case 11:return e.next=13,a.setAccountData("m.direct",An(An({},u),{},x({},c,[].concat(y(d),[n]))));case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ln=E.domain("cryptoDomain",{name:"cryptoDomain",sid:"-8alyey"}),Nn=Ln.store(null,{name:"$isKeyBackupEnabled",sid:"-a6imtu"}),Vn=Ln.effect({name:"checkBackupKeyFx",sid:"-kk44uw"}),zn=Ln.effect({name:"initCryptoFx",sid:"-13hk05"}),$n=Ln.event({name:"onCrossSigningKeyChange",sid:"5m4ppd"}),Wn=Ln.store(null,{name:"$isCryptoEnabled",sid:"h9e4ge"});try{qn=window.indexedDB}catch(e){}var Gn=null;function Hn(){return Jn.apply(this,arguments)}function Jn(){return(Jn=k(R.mark((function e(){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(qn){e.next=2;break}throw new Error("IndexedDB not available");case 2:return e.next=4,new Promise((function(e,t){var n=qn.open("indexdb-name-to-hold-account-data",1);n.onerror=t,n.onsuccess=function(t){e(n.result)},n.onupgradeneeded=function(e){var t=n.result;t.createObjectStore("pickleKey"),t.createObjectStore("account")}}));case 4:Gn=e.sent;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Yn=function(){var e=k(R.mark((function e(t,n){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Gn){e.next=3;break}return e.next=3,Hn();case 3:return e.abrupt("return",new Promise((function(e,r){var o=Gn.transaction([t],"readonly");o.onerror=r;var a=o.objectStore(t).get(n);a.onerror=r,a.onsuccess=function(t){e(a.result)}})));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Qn=function(){var e=k(R.mark((function e(t,n,r){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Gn){e.next=3;break}return e.next=3,Hn();case 3:return e.abrupt("return",new Promise((function(e,o){var a=Gn.transaction([t],"readwrite");a.onerror=o;var i=a.objectStore(t).put(r,n);i.onerror=o,i.onsuccess=function(t){e()}})));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Xn={};function Zn(e,t,n){}function er(e){return function(){var t=k(R.mark((function t(n){var a,i;return R.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.passphrase,i=n.recoveryKey,!a){t.next=5;break}return t.abrupt("return",o(a,e.passphrase.salt,e.passphrase.iterations));case 5:return t.abrupt("return",r(i));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}function tr(){return(tr=k(R.mark((function e(t){var n,r,o,a,i,s,c,u,d;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.keys,o=zt(),e.next=4,o.getDefaultSecretStorageKeyId();case 4:if(a=e.sent,r){e.next=7;break}return e.abrupt("return",["",new Uint8Array]);case 7:if(a&&((i=r[a])||(a="")),console.log("keyid",r[a]),a){e.next=14;break}if(!((s=Object.entries(r)).length>1)){e.next=13;break}throw new Error("Multiple storage key requests not implemented");case 13:s[0]&&(a=s[0][0],i=s[0][1]);case 14:e.next=16;break;case 16:if(!Xn.key){e.next=22;break}return e.next=19,zt().checkSecretStorageKey(Xn.key,i);case 19:if(!e.sent){e.next=22;break}return Xn.key,e.abrupt("return",[a,Xn.key]);case 22:return c=er(i),e.next=25,zt().createRecoveryKeyFromPassphrase("----");case 25:return u=e.sent,e.next=28,c({passphrase:"",recoveryKey:null==u||null===(n=u.keyInfo)||void 0===n?void 0:n.pubkey});case 28:if(d=e.sent,console.log("GOT IT",d,a),!a||!d){e.next=33;break}return e.abrupt("return",[a,d]);case 33:return e.abrupt("return",["",new Uint8Array]);case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nr(e){return rr.apply(this,arguments)}function rr(){return(rr=k(R.mark((function e(t){var n,r;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=er(t),e.next=3,n({passphrase:"",recoveryKey:""});case 3:return r=e.sent,Xn={key:new Uint8Array(r),keyInfo:t},e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function or(){return(or=k(R.mark((function e(t,n,r,o,i){var s,c,u,d,f;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onSecretRequested",t,n,r,o,i),s=zt(),t===s.getUserId()){e.next=4;break}return e.abrupt("return","");case 4:if(i&&i.isVerified()){e.next=7;break}return console.log("Ignoring secret request from untrusted device ".concat(n)),e.abrupt("return","");case 7:if("m.cross_signing.master"!==o&&"m.cross_signing.self_signing"!==o&&"m.cross_signing.user_signing"!==o){e.next=19;break}if((c=s.getCrossSigningCacheCallbacks()).getCrossSigningKeyCache){e.next=11;break}return e.abrupt("return","");case 11:return u=o.replace("m.cross_signing.",""),e.next=14,c.getCrossSigningKeyCache(u);case 14:return(d=e.sent)||console.log("".concat(u," requested by ").concat(n,", but not found in cache")),e.abrupt("return",d&&a(d));case 19:if("m.megolm_backup.v1"!==o){e.next=26;break}return e.next=22,s.crypto.getSessionBackupPrivateKey();case 22:if((f=e.sent)||console.log("session backup key requested by ".concat(n,", but not found in cache")),!f){e.next=26;break}return e.abrupt("return",a(f));case 26:return console.log("onSecretRequested didn't recognise the secret named ",o),e.abrupt("return","");case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ar={getSecretStorageKey:function(e){return tr.apply(this,arguments)},cacheSecretStorageKey:Zn,onSecretRequested:function(e,t,n,r,o){return or.apply(this,arguments)},getDehydrationKey:nr},ir=function(){var e=k(R.mark((function e(t,r){var o,a,i,s,c;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.crypto&&window.crypto.subtle){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,Yn("pickleKey",[t,r]);case 5:o=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("idbLoad for pickleKey failed",e.t0);case 11:if(o){e.next=13;break}return e.abrupt("return",null);case 13:if(o.encrypted&&o.iv&&o.cryptoKey){e.next=16;break}return console.log("Badly formatted pickle key"),e.abrupt("return",null);case 16:for(a=new Uint8Array(t.length+r.length+1),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);for(a[t.length]=124,s=0;s<r.length;s++)a[t.length+1+s]=r.charCodeAt(s);return e.prev=20,e.next=23,crypto.subtle.decrypt({name:"AES-GCM",iv:o.iv,additionalData:a},o.cryptoKey,o.encrypted);case 23:return c=e.sent,e.abrupt("return",n(c));case 27:return e.prev=27,e.t1=e.catch(20),console.log("Error decrypting pickle key"),e.abrupt("return",null);case 31:case"end":return e.stop()}}),e,null,[[2,8],[20,27]])})));return function(t,n){return e.apply(this,arguments)}}(),sr=function(){var e=k(R.mark((function e(t,r){var o,a,i,s,c,u,d,f;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.crypto&&window.crypto.subtle){e.next=2;break}return e.abrupt("return",null);case 2:return o=window.crypto,a=new Uint8Array(32),o.getRandomValues(a),e.next=7,o.subtle.generateKey({name:"AES-GCM",length:256},!1,["encrypt","decrypt"]);case 7:for(i=e.sent,s=new Uint8Array(32),o.getRandomValues(s),c=new Uint8Array(t.length+r.length+1),u=0;u<t.length;u++)c[u]=t.charCodeAt(u);for(c[t.length]=124,d=0;d<r.length;d++)c[t.length+1+d]=r.charCodeAt(d);return e.next=16,o.subtle.encrypt({name:"AES-GCM",iv:s,additionalData:c},i,a);case 16:return f=e.sent,e.prev=17,e.next=20,Qn("pickleKey",[t,r],{encrypted:f,iv:s,cryptoKey:i});case 20:e.next=25;break;case 22:return e.prev=22,e.t0=e.catch(17),e.abrupt("return",null);case 25:return e.abrupt("return",n(a));case 26:case"end":return e.stop()}}),e,null,[[17,22]])})));return function(t,n){return e.apply(this,arguments)}}();function cr(){return zt().getRooms().map(Fn)}p({and:{from:K.done.map((function(){return{initialSyncLimit:20}})),to:L},or:{sid:"w2hhoy"}}),$t([["Room.timeline",function(e,t,n,r,o){var a=e.getType();a!==xn&&a!==kn||!n&&o.liveEvent&&ht(Cn(e))}],["Room",function(e){var n,r,o=zt(),a=e.getMember(o.getUserId());a&&"invite"!==a.membership||(Boolean(null===(n=e.currentState.getStateEvents(t.RoomCreate,""))||void 0===n||null===(r=n.getContent())||void 0===r?void 0:r.isDirect)?$e(e):We(e))}],["Room.localEchoUpdated",function(){return yt()}],["sync",function(){var e=k(R.mark((function e(t,n){var r,o,a;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("PREPARED"!==t){e.next=6;break}return r=cr(),q(r),e.next=5,zt().uploadKeys();case 5:return e.abrupt("return");case 6:if("SYNCING"!==t||"PREPARED"!==n){e.next=10;break}return o=cr(),O(o),e.abrupt("return");case 10:if("SYNCING"!==t||"SYNCING"!==n){e.next=15;break}return a=cr(),yt(),M(a),e.abrupt("return");case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()],["RoomState.members",function(e,t,n){return qe(n)}],["RoomState.newMember",function(e,t,n){return qe(n)}],["RoomMember.membership",function(e,t){return qe(t)}],["RoomMember.name",function(e,t){return qe(t)}],["RoomMember.powerLevel",function(e,t){return qe(t)}],["RoomMember.typing",function(e,t){qe(t),Ae(t)}],["User.avatarUrl",function(e,t){return Oe(t)}],["User.presence",function(e,t){return Oe(t)}],["User.displayName",function(e,t){return Oe(t)}],["crossSigning.keysChanged",$n],["crypto.roomKeyRequest",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.log("crypto.roomKeyRequest",t)}],["crypto.roomKeyRequestCancellation",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.log("crypto.roomKeyRequestCancellation",t)}],["crypto.secrets.requestCancelled",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.log("crypto.secrets.requestCancelled",t)}],["crypto.suggestKeyRestore",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.log("crypto.suggestKeyRestore",t)}],["crypto.verification.request.unknown",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.log("crypto.verification.request.unknown",t)}],["crypto.verification.request",function(e){var t=zt(),n=t.getDeviceId(),r=t.getUserId();(t.checkDeviceTrust(r,n).isCrossSigningVerified()||e.isSelfVerification)&&(e.id=Date.now(),Xt(e))}],["crypto.warning",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.warn("crypto.warning",t)}],["crypto.keyBackupStatus",Vn],["crypto.willUpdateDevices",function(e,t){t||(nn(e),ln(e))}],["crypto.devicesUpdated",function(e){nn(e),ln(e)}],["deviceVerificationChanged",function(e){nn(e),ln(e)}],["userTrustStatusChanged",function(e){nn(e),ln(e)}]]),K.use(function(){var e=k(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zt().login("m.login.password",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),T.use(function(){var e=k(R.mark((function e(t){var n,r,o,a,i,s;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(t.baseUrl,"/_matrix/client/r0/login"),{method:"POST",body:JSON.stringify({type:"m.login.token",token:t.token})});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,o=r.user_id,a=r.access_token,i=r.device_id,s=r.well_known,e.abrupt("return",{userId:o,accessToken:a,deviceId:i,wellKnown:s});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_.use(k(R.mark((function e(){var t,n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=zt(),!(n=t.store)){e.next=3;break}return e.abrupt("return",n.startup());case 3:case"end":return e.stop()}}),e)})))),L.use((function(e){return zt().startClient(e)})),z.use(k(R.mark((function e(){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zt().logout();case 2:case"end":return e.stop()}}),e)})))),V.use((function(){return zt().stopClient()})),N.use(k(R.mark((function e(){var t,n,r,o,a;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=zt()){e.next=3;break}return e.abrupt("return",null);case 3:if(n=t.getUserId()){e.next=6;break}return e.abrupt("return",null);case 6:if(r=t.getUser(n)){e.next=9;break}return e.abrupt("return",null);case 9:if((o=Pn(r)).avatarUrl&&o.displayName){e.next=16;break}return e.next=13,t.getProfileInfo(n);case 13:a=e.sent,o.avatarUrl=a.avatar_url,o.displayName=a.displayname;case 16:return e.abrupt("return",o);case 17:case"end":return e.stop()}}),e)})))),$.use(function(){var e=k(R.mark((function e(t){var n,r,o,a;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.createClientParams,r=t.startClientParams,Vt(n),o=zt(),!(a=o.store)){e.next=7;break}return e.next=7,a.startup();case 7:return e.next=9,zn();case 9:return e.next=11,o.startClient(r);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),W.use(k(R.mark((function e(){var t,n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=zt()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.logout();case 5:return e.next=7,null===(t=n.store)||void 0===t?void 0:t.deleteAllData();case 7:n.stopClient(),Nt();case 9:case"end":return e.stop()}}),e)})))),G.use(function(){var e=k(R.mark((function e(t){var n,r;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=zt(),r=n.getUser(t)){e.next=4;break}throw new wn;case 4:return e.abrupt("return",Pn(r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),J.use((function(){return zt().getPushRules()})),Y.use(function(){var e=k(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zt().setPushRuleActions(t.scope,t.kind,t.ruleId,t.actions);case 3:e.next=10;break;case 5:throw e.prev=5,e.t0=e.catch(0),console.error("Error while setNotificationRuleAction.Fx"),console.error(e.t0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()),Q.use(function(){var e=k(R.mark((function e(t){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.error("Getting push rules..."),e.next=4,zt().getPushRules();case 4:return n=e.sent,console.error(n.global.room),e.next=8,zt().setPushRuleEnabled(t.scope,t.kind,t.ruleId,t.enabled);case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error while setNotificationRuleEnabled"),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()),X.use(function(){var e=k(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zt().deletePushRule(t.scope,t.kind,t.ruleId);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Kt.use(function(){var e=k(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zt().setDisplayName(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Tt.use(function(){var e=k(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zt().setAvatarUrl(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var ur=te.effect({name:"initRoomFx",sid:"lyysfp"}),dr=te.effect({name:"updatePowerLevelFx",sid:"-7zeavb"}),fr=te.effect({name:"updateRequiredPowerLevelForRoomFx",sid:"-jl0s5e"});function lr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return mr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function mr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pr(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gr=v({and:{effect:it},or:{name:"toLiveTimelineFx",sid:"-r93gj8"}}),wr=v({and:{effect:it},or:{name:"loadRoomMessageFx",sid:"-tksn78"}}),yr=v({and:{effect:it},or:{name:"loadInitialRoomFx",sid:"ntnfy0"}}),hr=D({source:Me,timeout:500}),br=v({and:{effect:ut},or:{name:"getRoomMembersFx",sid:"-wcjvao"}}),xr=v({and:{effect:st},or:{name:"getCurrentRoomFx",sid:"5ao94n"}});function kr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kr(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}ge.on(Ae,(function(e,t){if(t.typing)return e[t.roomId]?vr(vr({},e),{},x({},t.roomId,[].concat(y(e[t.roomId]),[t]))):vr(vr({},e),{},x({},t.roomId,[t]));if(e[t.roomId]){if(e[t.roomId].length>1){var n=e[t.roomId].filter((function(e){return e.userId!==t.userId}));return vr(vr({},e),{},x({},t.roomId,y(n)))}return delete e[t.roomId],vr({},e)}})).reset(Ee),fe.on(Be,(function(e,t){return t.roomId})).reset(me),le.on(xr.doneData,(function(e,t){return t})).reset(me),pe.on(ur.doneData,(function(e,t){return t})).reset(fe),de.on(br.doneData,(function(e,t){return t})).reset(fe),ve.on(dr.doneData,(function(e,t){return t})).reset(fe),we.on(fr.doneData,(function(e,t){return t.kick})).reset(fe),he.on(fr.doneData,(function(e,t){return t.ban})).reset(fe),ye.on(fr.doneData,(function(e,t){return t.invite})).reset(fe),be.on(fr.doneData,(function(e,t){return t.defaultEvents})).reset(fe),xe.on(fr.doneData,(function(e,t){return t.redact})).reset(fe),ke.on(fr.doneData,(function(e,t){return t.stateDefault})).reset(fe),p({and:{from:it.pending,to:ue},or:{sid:"-ba7oo0"}}),p({and:{from:Be,to:ur},or:{sid:"-awgttz"}}),p({and:{from:gr.done,to:Ke},or:{sid:"-au9ngj"}}),p({and:{from:g({and:[{source:pe,clock:ur.done,fn:function(){}}],or:{name:"from",sid:"9rjjb3"}}),to:Te},or:{sid:"-uj67zf"}}),p({and:{from:wr.done,to:_e},or:{sid:"-u2oe6l"}}),p({and:{from:yr.done,to:Le},or:{sid:"-u0h7t5"}}),w({and:[{clock:fe,filter:Boolean,target:xr}],or:{sid:"-tya1fp"}}),w({and:[{source:fe,filter:function(e){return Boolean(e)},target:Me}],or:{sid:"-tjze0b"}}),w({and:[{clock:Oe,source:de,filter:function(e,t){return Boolean(null==e?void 0:e.find((function(e){return e.userId===t.userId})))},target:Me}],or:{sid:"-th8f1i"}}),w({and:[{clock:qe,source:fe,filter:function(e,t){return e===t.roomId},target:Me}],or:{sid:"-t2dz0r"}}),w({and:[{source:fe,clock:hr,filter:Boolean,target:br}],or:{sid:"-snjj00"}}),w({and:[{source:g({and:[{source:[fe,pe],clock:Ne,fn:function(e,t){var n=h(e,2),r=n[0],o=n[1],a=t.initialEventId,i=t.initialWindowSize,s=t.loadAdditionalDataDirection;return{roomId:r,timelineWindow:o,initialEventId:a,initialWindowSize:i,loadAdditionalDataDirection:void 0===s?"BACKWARD":s}}}],or:{name:"source",sid:"-mxcvg3"}}),filter:Ue,target:yr}],or:{sid:"-sk8rfu"}}),w({and:[{source:g({and:[{source:[fe,pe],clock:ze,fn:function(e,t){var n=h(e,2);return{roomId:n[0],timelineWindow:n[1],initialEventId:t.initialEventId,initialWindowSize:t.initialWindowSize,loadAdditionalDataDirection:"BACKWARD"}}}],or:{name:"source",sid:"427l10"}}),filter:Ue,target:wr}],or:{sid:"-rowhm9"}}),w({and:[{source:g({and:[{source:[fe,pe],clock:Ve,fn:function(e){var t=h(e,2);return{roomId:t[0],timelineWindow:t[1],loadAdditionalDataDirection:"BACKWARD"}}}],or:{name:"source",sid:"l3tz80"}}),filter:Ue,target:gr}],or:{sid:"-r53w99"}}),w({and:[{clock:fe,filter:Boolean,target:[dr,fr]}],or:{sid:"-qmew2z"}}),dr.use((function(e){var t=zt(),n=t.getRoom(e),r=t.getUserId();if(!r)throw new wn;var o=n.getMember(r);if(!o)throw new wn;return o.powerLevel})),fr.use((function(e){var t,n,r,o,a,i,s=zt().getRoom(e).currentState.getStateEvents("m.room.power_levels","").getContent();return{kick:null!==(t=s.kick)&&void 0!==t?t:50,ban:null!==(n=s.ban)&&void 0!==n?n:50,invite:null!==(r=s.invite)&&void 0!==r?r:50,defaultEvents:null!==(o=s.events_default)&&void 0!==o?o:0,stateDefault:null!==(a=s.state_default)&&void 0!==a?a:50,redact:null!==(i=s.redact)&&void 0!==i?i:50}})),ut.use((function(e){var t=zt().getRoom(e);if(!t)throw new pn;return t.getMembers().map((function(e){var t=zt().getUser(e.userId);if(!t)throw new wn;return function(e,t){var n=void 0;return 100===e.powerLevel?n=U.admin:50===e.powerLevel&&(n=U.moderator),{membership:e.membership,name:e.name,powerLevel:e.powerLevel,powerLevelNorm:e.powerLevelNorm,rawDisplayName:e.rawDisplayName,roomId:e.roomId,typing:e.typing,user:Pn(t),userId:e.userId,role:n}}(e,t)}))})),Ye.use((function(e){var t=zt().getRoom(e);if(!t)throw new pn;return function(e){return{roomMembersCount:e.getJoinedMemberCount()}}(t)})),ur.use(function(){var t=k(R.mark((function t(n){var r,o,a,i;return R.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.roomId,o=zt(),a=zt().getRoom(r)){t.next=5;break}throw new pn;case 5:return i=a.getUnfilteredTimelineSet(),t.abrupt("return",new e.TimelineWindow(o,i));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),it.use(function(){var t=k(R.mark((function t(n){var r,o,a,s,c,u,d,f;return R.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.timelineWindow,o=n.initialEventId,a=n.initialWindowSize,s=n.loadAdditionalDataDirection,r){t.next=3;break}throw new gn;case 3:return t.next=5,r.load(o,a);case 5:if(c=r.canPaginate(i.Forward),u=On(r),!(a&&u.length<a)){t.next=19;break}if(f=a-u.length,"BACKWARD"!==s){t.next=15;break}return t.next=12,r.paginate(e.EventTimeline.BACKWARDS,f);case 12:d=t.sent,t.next=18;break;case 15:return t.next=17,r.paginate(e.EventTimeline.FORWARDS,f);case 17:d=t.sent;case 18:d&&(u=On(r));case 19:return t.abrupt("return",{messages:u,isLive:!c,canPaginateForward:c,canPaginateBackward:r.canPaginate(i.Backward)});case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Je.use((function(e){if(!zt())throw new vn;return e.map((function(e){return Un(e)}))})),He.use(function(){var e=k(R.mark((function e(t){var n,r,o,a,i,u,d;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.term,r=t.roomId,o=t.orderBy,a=void 0===o?c.Rank:o,i=zt().getRoom(r)){e.next=4;break}throw new pn;case 4:return u={},e.next=7,zt().search({body:{search_categories:{room_events:{search_term:n,keys:["content.body"],filter:{rooms:[r]},order_by:a}}}});case 7:return d=e.sent,e.abrupt("return",d.search_categories.room_events.results.map((function(e){var t=e.result,n=new s(t),r=n.getSender();return void 0===u[r]&&(u[r]=i.getMember(r)),n.sender=u[r],Cn(n)})));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Qe.use((function(){return zt().getUsers().map(Pn)})),Xe.use(function(){var e=k(R.mark((function e(t){var n,r,o,a,i,s,c,u,d;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,r=t.invite,o=t.visibility,a=t.initialState,i=void 0===a?[]:a,s=t.preset,c={name:n,invite:r,visibility:o,initial_state:i.map((function(e){return vr(vr({},e),{},{state_key:e.stateKey,stateKey:void 0})})),preset:s},e.next=4,zt().createRoom(c);case 4:return u=e.sent,d=u.room_id,e.abrupt("return",{roomId:d});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ze.use(function(){var e=k(R.mark((function e(t){var n,r,o,a,i,s,c,u,d,f;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.user,r=t.preset,o=t.initialState,a=void 0===o?[]:o,i=zt(),l=void 0,l=zt().getAccountData("m.direct").getContent(),s=l&&Object.values(l).flatMap((function(e){return e})),!(c=s.find((function(e){var t;return null===(t=i.getRoom(e))||void 0===t?void 0:t.currentState.members[n.userId]})))){e.next=6;break}return e.abrupt("return",{roomId:c});case 6:return u={is_direct:!0,invite:[n.userId],visibility:Z.private,initial_state:a.map((function(e){return vr(vr({},e),{},{state_key:e.stateKey,stateKey:void 0})})),preset:r,creation_content:{isDirect:!0,creator:i.getUserId()}},e.next=9,i.createRoom(u);case 9:return d=e.sent,f=d.room_id,e.next=13,_n(f,n.userId);case 13:return e.abrupt("return",{roomId:f});case 14:case"end":return e.stop()}var l}),e)})));return function(t){return e.apply(this,arguments)}}()),et.use(function(){var e=k(R.mark((function e(n){var r,o,a,i,s;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.userId,i=n.roomId,s=zt().getRoom(i)){e.next=4;break}throw new pn("Room ".concat(i," not found"));case 4:if(!(null===(r=s.currentState.getStateEvents(t.RoomCreate,""))||void 0===r||null===(o=r.getContent())||void 0===o?void 0:o.isDirect)){e.next=7;break}throw new hn("Can't invite users into a direct room");case 7:return e.prev=7,e.next=10,zt().invite(i,a);case 10:return e.next=12,zt().sendSharedHistoryKeys(i,[a]);case 12:e.next=18;break;case 14:if(e.prev=14,e.t0=e.catch(7),403!==e.t0.httpStatus){e.next=18;break}throw new bn("Not enough permissions to invite users");case 18:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(t){return e.apply(this,arguments)}}()),tt.use(function(){var e=k(R.mark((function e(n){var r,o,a,i,s,c,u,d;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.usersIds,i=n.roomId,s=zt().getRoom(i)){e.next=4;break}throw new pn("Room ".concat(i," not found"));case 4:if(!(null===(r=s.currentState.getStateEvents(t.RoomCreate,""))||void 0===r||null===(o=r.getContent())||void 0===o?void 0:o.isDirect)){e.next=7;break}throw new hn("Can't invite users into a direct room");case 7:c=lr(a),e.prev=8,c.s();case 10:if((u=c.n()).done){e.next=25;break}return d=u.value,e.prev=12,e.next=15,zt().invite(i,d);case 15:return e.next=17,zt().sendSharedHistoryKeys(i,[d]);case 17:e.next=23;break;case 19:if(e.prev=19,e.t0=e.catch(12),403!==e.t0.httpStatus){e.next=23;break}throw new bn;case 23:e.next=10;break;case 25:e.next=30;break;case 27:e.prev=27,e.t1=e.catch(8),c.e(e.t1);case 30:return e.prev=30,c.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[8,27,30,33],[12,19]])})));return function(t){return e.apply(this,arguments)}}()),nt.use(function(){var e=k(R.mark((function e(t){var n,r,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.roomId,r=t.userId,o=t.reason,e.next=3,zt().kick(n,r,o);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),rt.use(function(){var e=k(R.mark((function e(t){var n,r;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.roomId,r=t.name,e.next=3,zt().setRoomName(n,r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ot.use(function(){var e=k(R.mark((function e(t){var n,r,o,a,i,s;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.roomId,r=t.isDirect,o=void 0!==r&&r,a=zt(),e.next=4,a.joinRoom(n);case 4:if(i=e.sent,!o){e.next=8;break}return e.next=8,_n(n);case 8:if(!a.isRoomEncrypted(n)){e.next=18;break}return e.next=11,a.setRoomEncryption(a.getUserId(),{algorithm:"m.megolm.v1.aes-sha2"});case 11:return e.next=13,i.getEncryptionTargetMembers();case 13:return s=e.sent.map((function(e){return e.userId})),e.next=16,a.downloadKeys(s,!0);case 16:return e.next=18,a.downloadKeysForUsers(s,{});case 18:return e.abrupt("return",Un(Fn(i)));case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),st.use((function(e){var t=zt().getRoom(e);return t?Un(Fn(t)):null})),at.use(function(){var e=k(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zt().leave(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ge.use((function(e){var t,n=zt(),r=null===(t=n.getAccountData("m.direct"))||void 0===t?void 0:t.getContent(),o=r[e]&&r[e][0];if(!o)throw new pn;var a=n.getRoom(o);if(!a)throw new pn;return Fn(a)})),ct.use(function(){var e=k(R.mark((function e(t){var n,r;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.roomId,r=t.isTyping,e.next=3,zt().sendTyping(n,r,5e3);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),dt.use((function(e){var t=e.roomId,n=e.userId,r=zt().getRoom(t);if(!r)throw new pn("".concat(t," room not found"));var o=null==r?void 0:r.getMember(n);if(!o)throw new wn("".concat(n," room member not found"));return o})),ft.use(function(){var e=k(R.mark((function e(t){var n,r,o,a,i,s,c,u,d,f,l,m;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=zt(),r=n.getRoom(t)){e.next=4;break}throw new pn("Room ".concat(t," not found"));case 4:if(o=n.getUserId(),a=r.getMember(o)){e.next=8;break}throw new wn("User ".concat(o," not found"));case 8:return i=a.powerLevel,s=r.currentState.getStateEvents("m.room.power_levels","").getContent(),c=s.kick,u=s.ban,d=s.invite,f=s.events_default,l=s.state_default,m=s.redact,e.abrupt("return",{canKick:i>=c,canBan:i>=u,canInvite:i>=d,canSendDefaultEvent:i>=f,canSetDefaultState:i>=l,canRedact:i>=m});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),lt.use(function(){var e=k(R.mark((function e(t){var n,r;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=zt(),r=n.getUserId()===t,e.abrupt("return",n.getStoredDevicesForUser(t).map((function(e){var o=n.checkDeviceTrust(t,e.deviceId),a=r?o.isCrossSigningVerified():o.isVerified();return{deviceId:e.deviceId,displayName:e.getDisplayName(),verified:a}})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var Ir=vt.effect({name:"paginateRoomFx",sid:"-cda6s"}),Dr=v({and:{source:[fe,pe],effect:Ir,mapParams:function(e,t){var n=h(t,2);return Rr({roomId:n[0],timelineWindow:n[1],direction:"backward"},e)}},or:{name:"paginateBackwardFx",sid:"-l3ms9e"}}),Sr=v({and:{source:[fe,pe],effect:Ir,mapParams:function(e,t){var n=h(t,2);return Rr({roomId:n[0],timelineWindow:n[1],direction:"forward"},e)}},or:{name:"paginateForwardFx",sid:"twto50"}}),Cr=vt.effect({name:"updateMessagesFx",sid:"-mgbiwh"}),Fr=w({and:[{source:g({and:[fe,[it.done,Ir.done,Cr.done],function(e,t){return Rr({currentRoomId:e,roomId:t.params.roomId},t.result)}],or:{name:"source",sid:"23v080"}}),filter:function(e){return e.currentRoomId===e.roomId}}],or:{name:"setMessages",sid:"-pyylc1"}}),jr=vt.effect({name:"updateCurrentRoomUnreadMessageCountFx",sid:"p100hv"}),Pr=Wt(),Ur=v({and:{effect:Sr,mapParams:function(e){return{size:e.messages.length}}},or:{name:"loadNewMessagesFx",sid:"-gr85hu"}});gt.on(Fr,(function(e,t){return t.messages})).reset(fe),wt.on(jr.doneData,(function(e,t){return t})).reset(fe),ce.on(Fr,(function(e,t){return t.isLive})).reset(fe);var Er=m({and:[Ue,Ct,St,ue,function(e,t,n,r){return e&&!t&&!n&&!r}],or:{name:"$paginateFilter",sid:"l33f2f"}});Ct.on(Dr.pending,(function(e,t){return t})).reset(fe),St.on(Sr.pending,(function(e,t){return t})).reset(fe),Ft.on(Fr,(function(e,t){return t.canPaginateBackward})).reset([Ne,fe]),jt.on(Fr,(function(e,t){return t.canPaginateForward})).reset([Ne,fe]),p({and:{from:Dr.done,to:kt},or:{sid:"-3j4xrm"}}),p({and:{from:Sr.done,to:Rt},or:{sid:"-3gxre6"}}),w({and:[{source:Dt,filter:Er,target:Dr}],or:{sid:"-336wk5"}}),w({and:[{source:It,filter:Er,target:Sr}],or:{sid:"-30fxlc"}}),p({and:{from:g({and:[gt,Ur.done,function(e,t){return t.params.messages}],or:{name:"from",sid:"-oneqdy"}}),to:bt},or:{sid:"-2m5a5y"}}),p({and:{from:Pr.map((function(e){return{messages:e}})),to:Ur},or:{sid:"-2jy3si"}}),w({and:[{source:g({and:[[fe,pe],S({source:yt,timeout:800}),function(e){var t=h(e,2),n=t[0];return{timelineWindow:t[1],roomId:n}}],or:{name:"source",sid:"51qrdo"}}),filter:pe.map((function(e){return Boolean(e)})),target:Cr}],or:{sid:"-2678yh"}}),w({and:[{clock:gt.updates,source:fe,filter:function(e){return Boolean(e)},target:jr}],or:{sid:"-1oltyx"}}),g({and:[{clock:C({source:Pt.done,timeout:500}),fn:function(e){var t=e.params,n=e.result;return{roomId:t.roomId,eventId:n.event_id}},target:At}],or:{sid:"-1lb2er"}}),Pt.use(function(){var e=k(R.mark((function e(t){var n,r,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.roomId,r=t.content,o=t.txnId,e.next=3,zt().sendMessage(n,r,o);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ut.use(function(){var e=k(R.mark((function e(t){var n,r,o,a;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.roomId,r=t.eventId,o=t.body,a=t.txnId,e.next=3,zt().sendMessage(n,{"m.new_content":{msgtype:"m.text",body:o},"m.relates_to":{rel_type:"m.replace",event_id:r},msgtype:"m.text",body:""},a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Et.use(function(){var e=k(R.mark((function e(t){var n,r,o,a,i;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.roomId,r=t.eventId,o=t.reason,a=o?{reason:o}:void 0,e.next=4,zt().redactEvent(n,r,void 0,a);case 4:return i=e.sent,e.abrupt("return",{eventId:i.event_id});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),At.use(function(){var e=k(R.mark((function e(t){var n,r,o,a;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.roomId,r=t.eventId,o=zt().getRoom(n)){e.next=4;break}throw new pn;case 4:if(a=o.findEventById(r)){e.next=7;break}throw new mn;case 7:return e.next=9,zt().setRoomReadMarkers(n,r,a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),qt.use((function(e){var t=e.file,n=e.name,r=e.includeFilename,o=e.onlyContentUri,a=e.rawResponse,i=e.type,s=zt().uploadContent(t,{name:n,includeFilename:r,type:i,onlyContentUri:o,rawResponse:a,progressHandler:function(e){var n=e.loaded,r=e.total;xt({file:t,loaded:n,total:r})}}),c={promise:s};return s.abort&&(c.abort=s.abort),c})),Mt.use((function(e){var t=e.url,n=e.ts,r=e.timeout,o=void 0===r?5e3:r;return new Promise((function(e){zt().getUrlPreview(t,n).then(e).catch((function(){return e({"og:url":t})})),setTimeout((function(){e({"og:url":t})}),o)}))})),Ot.use((function(e){var t=e.eventId,n=e.roomId,r=zt();if(!r)throw new vn;var o=r.getRoom(n);if(!o)throw new pn;var a=o.findEventById(t);if(!a)throw new mn;var i=r.getUserId();if(!i)throw new yn;var s=o.currentState.maySendRedactionForEvent(a,i)&&"m.room.server_acl"!==a.getType(),c=function(e){if(e.status===u.CANCELLED||"m.room.message"!==e.getType()||e.isRedacted())return!1;var t=e.getOriginalContent(),n=t.msgtype;return("m.text"===n||"m.emote"===n)&&Boolean(t.body)&&"string"==typeof t.body&&e.getSender()===zt().getUserId()}(a);return{canRedact:s,canEdit:c}})),Cr.use((function(e){var t=e.timelineWindow,n=t.canPaginate(i.Forward);return{messages:On(t),isLive:!n,canPaginateForward:n,canPaginateBackward:t.canPaginate(i.Backward)}})),Ir.use(function(){var t=k(R.mark((function t(n){var r,o,a,s,c,u,d,f;return R.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.timelineWindow,o=n.direction,a=n.size,s=n.makeRequest,c=n.requestLimit,r){t.next=3;break}throw new gn;case 3:return u="forward"===o?e.EventTimeline.FORWARDS:e.EventTimeline.BACKWARDS,t.next=6,r.paginate(u,a,s,c);case 6:return d=r.canPaginate(i.Forward),f=On(r),t.abrupt("return",{messages:f,isLive:!d,canPaginateForward:d,canPaginateBackward:r.canPaginate(i.Backward)});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),jr.use((function(e){var t=zt().getRoom(e);if(!t)throw new pn;var n=t.getUnreadNotificationCount();return null!=n?n:0}));var Ar=Ln.effect({name:"crossSigningChangeFx",sid:"ypb1eu"}),Or=Ln.event({name:"setEnableCrypto",sid:"-j5gxp2"});Nn.on(Vn.doneData,(function(e,t){return t})),Wn.on(Or,(function(e,t){return t})),p({and:{from:$n,to:Ar},or:{sid:"or9jok"}}),Vn.use(k(R.mark((function e(){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",zt().getKeyBackupEnabled());case 1:case"end":return e.stop()}}),e)})))),zn.use(k(R.mark((function e(){var t,n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=zt()).initCrypto){e.next=4;break}return Or(!1),e.abrupt("return");case 4:return e.next=6,t.initCrypto();case 6:return Or(!0),t.setGlobalErrorOnUnknownDevices(!1),t.setCryptoTrustCrossSignedDevices(!0),e.next=11,t.getKeyBackupVersion();case 11:(n=e.sent)&&t.restoreKeyBackupWithSecretStorage(n).then(console.log),rn();case 14:case"end":return e.stop()}}),e)})))),Ar.use(k(R.mark((function e(){var t;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=zt(),e.next=3,t.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing");case 3:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:if(t.isCryptoEnabled()){e.next=7;break}return e.abrupt("return");case 7:if(t.isInitialSyncComplete()){e.next=9;break}return e.abrupt("return");case 9:rn();case 10:case"end":return e.stop()}}),e)}))));var qr=Gt.effect({name:"startSASFx",sid:"wiij31"}),Mr=Gt.effect({name:"confirmSASVerificationFx",sid:"eq6hnq"}),Br=Gt.event({name:"onCancelVerificationEvent",sid:"y17lnz"}),Kr=Gt.event({name:"updateVerificationPhase",sid:"-8fjyrx"}),Tr=Gt.event({name:"updateDeviceVerification",sid:"-bn74gn"}),_r=Gt.effect({name:"onVerificationRequestFx",sid:"-s0hbp2"}),Lr=Gt.effect({name:"startVerificationDeviceFx",sid:"-jjmhtd"}),Nr=Gt.effect({name:"startVerificationUserFx",sid:"dy8zg9"}),Vr=Gt.effect({name:"requestAcceptFx",sid:"-wlsmvm"}),zr=Gt.effect({name:"cancelAllRequestsFx",sid:"rq17vr"});tn.on(Tr,(function(e,t){return t})),Qt.on(_r.doneData,(function(e,t){return[].concat(y(e),[t])})).on(Kr,(function(e){return y(e)})).on(Br,(function(e,t){return e.filter((function(e){return e.id!==t.id}))})),Ht.on(Jt,(function(e,t){return[t]})).on(Br,(function(e,t){var n=h(e,1)[0];return(null==n?void 0:n.id)===t.id?[]:[n]})).on(Kr,(function(e){return[h(e,1)[0]]})),p({and:{from:rn.doneData,to:Tr},or:{sid:"s08z8f"}}),p({and:{from:nn,to:rn},or:{sid:"s2g5lv"}}),p({and:{from:Yt.doneData,to:Br},or:{sid:"sg70fw"}}),p({and:{from:on,to:Lr},or:{sid:"sie6tc"}}),p({and:{from:sn,to:Nr},or:{sid:"skld6s"}}),p({and:{from:[Nr.doneData,Lr.doneData],to:Xt},or:{sid:"syc80t"}}),p({and:{from:cn,to:Vr},or:{sid:"t26s6c"}}),p({and:{from:un,to:Yt},or:{sid:"tfxn0d"}}),g({and:[{clock:Xt,source:Ht,fn:function(e,t){return{request:t,currentRequest:h(e,1)[0]}},target:_r}],or:{sid:"ti4tdt"}}),g({and:[{clock:dn,source:Qt,target:zr}],or:{sid:"ty2ula"}}),w({and:[{clock:en,source:Ht.map((function(e){return e.length?e[0]:null})),filter:function(e){return Boolean(e)},target:Mr}],or:{sid:"ucdi0o"}}),w({and:[{clock:Zt,source:Ht.map((function(e){return e.length?e[0]:null})),filter:function(e){return Boolean(e)},target:qr}],or:{sid:"ug8267"}}),_r.use(function(){var e=k(R.mark((function e(t){var n,r,o,a;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.request,r=t.currentRequest,o=function e(){return n.cancelled?(n.off(d.Change,e),Br(n),void console.error("request.cancelled",n.cancellationCode)):n.phase===pt.Done?(n.off(d.Change,e),Br(n),void ln([n.otherUserId])):n.phase===pt.Ready?(r&&(null==r?void 0:r.id)!==n.id&&Yt(r),Kr(),void Jt(n)):void(n.phase!==pt.Started||n.verifier.sasEvent||qr(n))},n.on(d.Change,o),a=[pt.Cancelled,pt.Done,pt.Requested],r||a.includes(n.phase)){e.next=9;break}if(Jt(n),n.phase!==pt.Started||n.verifier.sasEvent){e.next=9;break}return e.next=9,qr(n);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Vr.use(function(){var e=k(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.accept();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),qr.use(function(){var e=k(R.mark((function e(t){var n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.beginKeyVerification("m.sas.v1")).once("show_sas",Kr),n.once("cancel",(function(){return Br(t)})),e.next=5,n.verify();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Yt.use(function(){var e=k(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.cancel();case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Mr.use(function(){var e=k(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.verifier.sasEvent.confirm();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),rn.use(k(R.mark((function e(){var t,n,r,o;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=zt(),n=t.getDeviceId(),r=t.getUserId(),e.next=5,t.downloadKeys([r]);case 5:return o=t.checkDeviceTrust(r,n).isCrossSigningVerified(),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))),an.use(k(R.mark((function e(){var t,n;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=zt(),e.next=3,t.requestVerification(t.getUserId());case 3:(n=e.sent).id=Date.now(),Xt(n);case 6:case"end":return e.stop()}}),e)})))),Lr.use(function(){var e=k(R.mark((function e(t){var n,r,o,a;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userId,r=t.deviceId,o=zt(),e.next=4,o.requestVerification(n,[r]);case 4:return(a=e.sent).id=Date.now(),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var $r=v({and:{effect:Ze},or:{name:"findOrCreateDirectRoomFx",sid:"m2cmis"}});Nr.use(function(){var e=k(R.mark((function e(t){var n,r,o,a;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=zt(),r=n.getUser(t),e.next=4,$r({user:r});case 4:return o=e.sent,e.next=7,n.requestVerificationDM(t,o.roomId);case 7:return(a=e.sent).id=Date.now(),e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),zr.use(function(){var e=k(R.mark((function e(t){return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach((function(e){return e.cancel()}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),fn.use(function(){var e=k(R.mark((function e(t){var n,r,o,a,i,s,c,u,d,f;return R.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.profileId,r=zt(),o=r.isCryptoEnabled(),e.next=5,r.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing");case 5:return a=e.sent,i=r.getDeviceId(),s=r.getUserId(),e.next=10,r.downloadKeys([s]);case 10:if(c=r.checkDeviceTrust(s,i).isCrossSigningVerified(),u=o&&r.checkUserTrust(n),d=o&&u&&u.isCrossSigningVerified(),!(n===r.getUserId())||!c){e.next=16;break}return e.abrupt("return",!0);case 16:return f=o&&a&&!d&&c,e.abrupt("return",f);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());export{Ce as $canBan,Se as $canInvite,De as $canKick,Ft as $canPaginateBackward,jt as $canPaginateForward,je as $canRedact,Fe as $canSendDefaultEvent,Pe as $canSetDefaultState,Re as $currentJoinedRoomMembers,le as $currentRoom,fe as $currentRoomId,Ie as $currentRoomInvitedMembers,de as $currentRoomMembers,wt as $currentRoomUnreadMessageCount,Ht as $currentVerificationEvent,tn as $deviceIsVerified,Wn as $isCryptoEnabled,Nn as $isKeyBackupEnabled,ce as $isLive,Ue as $loadFilter,ue as $loadRoomFxPending,gt as $messages,ve as $myPowerLevel,Ct as $paginateBackwardPending,St as $paginateForwardPending,he as $requiredPowerLevelForBan,be as $requiredPowerLevelForDefaultEvents,ke as $requiredPowerLevelForDefaultState,ye as $requiredPowerLevelForInvite,we as $requiredPowerLevelForKick,xe as $requiredPowerLevelForRedact,pe as $timelineWindow,ge as $typingMembers,Qt as $verificationEvents,sr as CreatePickleKey,re as DEFAULT_BAN_POWERLEVEL,ne as DEFAULT_INVITE_POWERLEVEL,oe as DEFAULT_KICK_POWERLEVEL,se as DEFAULT_REDACT_POWERLEVEL,ae as DEFAULT_SEND_DEFAULT_EVENT_POWERLEVEL,ie as DEFAULT_SET_DEFAULT_STATE_POWERLEVEL,ir as GetPickleKey,P as MatrixMembershipType,F as MsgType,pt as Phase,j as Presence,ee as Preset,U as UserRole,Z as Visibility,dn as cancelAllRequests,Yt as cancelVerificationEventFx,Vn as checkBackupKeyFx,fn as checkCanVerifyFx,Ot as checkEventPermissionsFx,rn as checkThisDeviceVerificationFx,me as clearCurrentRoomState,Ee as clearTypingMember,zt as client,en as confirmSASVerification,Vt as createClient,$ as createClientFx,Ze as createDirectRoomFx,B as createOnSyncThrottled,Xe as createRoomFx,Wt as createRoomMessageBatch,ar as crossSigningCallbacks,Et as deleteMessageFx,X as deleteNotificationRuleFx,Nt as destroyClient,W as destroyClientFx,$e as directRoomCreated,Ut as editMessageFx,Ge as findDirectRoomByUserIdFx,Qe as getAllUsersFx,nr as getDehydrationKey,N as getLoggedUserFx,ut as getMembersByRoomIdFx,J as getNotificationRulesFx,ft as getPermissionsByRoomIdFx,G as getProfileInfoFx,st as getRoomByIdFx,Ye as getRoomInfoFx,Bn as getRoomMemberAvatarUrl,dt as getRoomMemberFx,Me as getRoomMembers,Je as getRoomsWithActivitiesFx,Mn as getSenderAvatarUrl,Tn as getUploadCredentials,Mt as getUrlPreviewFx,lt as getUserDevicesFx,zn as initCryptoFx,Be as initRoom,_ as initStoreFx,et as inviteUserFx,tt as inviteUsersFx,ot as joinRoomFx,nt as kickUserRoomFx,at as leaveRoomFx,Ke as liveTimelineLoaded,Ne as loadRoom,it as loadRoomFx,ze as loadRoomMessage,_e as loadRoomMessageDone,K as loginByPasswordFx,T as loginByTokenFx,z as logoutFx,Kn as mxcUrlToHttp,bt as newMessagesLoaded,q as onCachedState,$t as onClientEvent,$n as onCrossSigningKeyChange,O as onInitialSync,kt as onPaginateBackwardDone,Rt as onPaginateForwardDone,cn as onRequestAccept,un as onRequestCancel,Te as onRoomInitialized,Le as onRoomLoaded,qe as onRoomMemberUpdate,Oe as onRoomUserUpdate,M as onSync,nn as onUpdateDeviceList,xt as onUploadProgress,ln as onUsersProfileUpdate,Xt as onVerificationRequest,Dt as paginateBackward,It as paginateForward,At as readAllMessagesFx,rt as renameRoomFx,We as roomCreated,ht as roomMessage,He as searchRoomMessagesFx,Pt as sendMessageFx,ct as sendTypingFx,Jt as setCurrentVerificationEvent,Y as setNotificationRuleActionFx,Q as setNotificationRuleEnabledFx,L as startClientFx,Zt as startSASVerification,an as startThisDeviceVerificationFx,on as startVerificationDevice,sn as startVerificationUser,V as stopClientFx,Ve as toLiveTimeline,Ae as toggleTypingUser,Tt as updateAvatarUrlFx,Kt as updateDisplayNameFx,yt as updateMessages,qt as uploadContentFx};
//# sourceMappingURL=index.js.map
